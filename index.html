<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;700&display=swap" rel="stylesheet">
    <title>PromptCard â€“ ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§ã‚³ãƒ”ãƒ¼ã§ãã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆé›†</title>
    <meta name="description" content="ç”¨é€”åˆ¥ã«ã¾ã¨ã‚ãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§ã‚³ãƒ”ãƒ¼ã€‚æ¤œç´¢ãƒ»ã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒ»ãŠæ°—ã«å…¥ã‚Šãƒ»ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ãƒ»JSONã‚¤ãƒ³ãƒãƒ¼ãƒˆ/ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå¯¾å¿œã€‚" />
    <style>
      :root {
        /* èƒŒæ™¯è‰² */
        --bg-primary: #0f1023;
        --bg-secondary: #17183a;
        --bg-tertiary: #1c1f49;

        /* ãƒ†ã‚­ã‚¹ãƒˆ */
        --text-primary: #f3f4ff;
        --text-muted: #cfd6ff;

        /* ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ */
        --primary: #ff9bd3;
        --secondary: #cdb4ff;
        --success: #4ad4a0;
        --warning: #ffd86b;
        --error: #ff6b81;

        /* UIè¦ç´  */
        --border: #303875;
        --border-light: rgba(255,255,255,0.1);
        --shadow: 0 14px 30px rgba(0,0,0,0.28);
        --shadow-hover: 0 20px 40px rgba(0,0,0,0.35);

        /* äº’æ›æ€§ç¶­æŒ */
        --bg: var(--bg-primary);
        --panel: var(--bg-secondary);
        --panel-2: var(--bg-tertiary);
        --text: var(--text-primary);
        --muted: var(--text-muted);
        --accent: var(--primary);
        --accent-2: var(--secondary);
        --danger: var(--error);
        --ok: var(--success);
      }

      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body {
        margin: 0;
        font-family: 'M PLUS Rounded 1c', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        background: radial-gradient(1000px 500px at 85% -10%, #2a2d64 0%, #15163a 55%, #0f1023 100%);
        color: var(--text);
        letter-spacing: 0.2px;
      }

      a { color: var(--accent-2); text-decoration: none; }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 24px 20px 40px;
      }

      header {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 16px;
        align-items: center;
        margin-bottom: 18px;
      }

      .title {
        display: flex;
        gap: 14px;
        align-items: center;
      }
      .title h1 { font-size: 22px; margin: 0; font-weight: 700; }
      .title h1::after { content: ' âœ¨'; font-size: 90%; opacity: .9; }
      .title .badge { font-size: 12px; color: #ffe7f5; background: linear-gradient(180deg, rgba(255,155,211,.22), rgba(205,180,255,.18)); border: 1px solid rgba(255,155,211,.35); padding: 4px 10px; border-radius: 999px; backdrop-filter: blur(6px); }

      .controls {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: flex-end;
      }
      .control, select, textarea, input[type="text"] { background: linear-gradient(180deg, #1b1e4a, #14183e); border: 1px solid var(--border); color: var(--text); border-radius: 14px; padding: 10px 12px; font-size: 14px; outline: none; transition: 0.15s ease, box-shadow .15s ease; }
      .control::placeholder { color: #d6dbff; opacity: .6; }
      .control:focus, select:focus, textarea:focus, input[type="text"]:focus { border-color: var(--accent); box-shadow: 0 0 0 4px rgba(255,155,211,.18), 0 8px 20px rgba(255,155,211,.12); }
      .btn {
        cursor: pointer;
        background: linear-gradient(180deg, var(--primary), var(--secondary));
        border: 1px solid rgba(255,155,211,.55);
        color: white;
        padding: 10px 14px;
        border-radius: 999px;
        font-weight: 600;
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); /* ã‚ˆã‚Šæ»‘ã‚‰ã‹ãªãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ */
        position: relative;
        overflow: hidden;
        margin: 0 2px; /* ãƒœã‚¿ãƒ³é–“ã«å®‰å®šã—ãŸåˆ¤å®šé ˜åŸŸã‚’ä½œã‚‹ */
      }
      .btn:hover {
        background: linear-gradient(180deg, rgba(255,155,211,1.1), rgba(205,180,255,1));
        box-shadow: 0 8px 20px rgba(255,155,211,.3);
        filter: brightness(1.05) drop-shadow(0 1px 3px rgba(255,155,211,.2));
        transform: translateY(0); /* ä½ç½®ã¯å‹•ã‹ã•ãªã„ */
      }
      .btn:active {
        background: linear-gradient(180deg, rgba(255,155,211,0.8), rgba(205,180,255,0.7)); /* ã‚¯ãƒªãƒƒã‚¯æ™‚ã¯å°‘ã—æš—ã */
        box-shadow: 0 2px 8px rgba(255,155,211,.1);
      }
      .btn.secondary {
        background: linear-gradient(180deg, var(--success), var(--secondary));
        border-color: rgba(74,212,160,.45);
        color: #14203a;
      }
      .btn.copied {
        background: linear-gradient(180deg, var(--success), #23794b);
        border-color: var(--success);
        color: #eafff1;
      }
      .btn.failed {
        background: linear-gradient(180deg, var(--error), #8e3b46);
        border-color: var(--error);
        color: #ffeef0;
      }
      .btn.ghost {
        background: transparent;
        border: 1px dashed rgba(255,255,255,.25);
        color: var(--muted);
        border-radius: 999px;
      }
      .btn.ghost:hover {
        background: rgba(255,255,255,0.05);
        border-color: rgba(255,255,255,.4);
      }

      .toolbar {
        display: grid;
        grid-template-columns: 1fr auto auto auto;
        gap: 12px;
        align-items: center;
        background: linear-gradient(180deg, #141a3a, #101534);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 12px;
        box-shadow: var(--shadow);
        position: sticky;
        top: 10px;
        z-index: 10;
      }
      .toolbar input, .toolbar select { height: 40px; }
      /* Windowsç­‰ã®ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã§æ–‡å­—ãŒè–„ããªã‚‹ã®ã‚’å›é¿ */
      select option { color: #162039; background: #ffffff; }
      select option:checked { color: #ffffff; background: #5563df; }
      select option:hover { background: #eef1ff; }
      .search { display: flex; align-items: center; gap: 8px; min-width: 240px; }
      .search input { width: 100%; }
      .switch { display: inline-flex; align-items: center; gap: 8px; color: var(--muted); font-size: 13px; white-space: nowrap; }
      #category.control { min-width: 200px; }
      #sort.control { min-width: 180px; }

      .grid {
        margin-top: 16px;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 16px;
      }

      .card {
        background: linear-gradient(180deg, var(--panel), var(--panel-2));
        border: 1px solid var(--border);
        border-radius: 18px;
        padding: 14px;
        box-shadow: var(--shadow);
        display: flex;
        flex-direction: column;
        gap: 6px;
        transition: border-color .15s ease, transform .15s ease, box-shadow .15s ease;
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
      }

      .card:hover {
        border-color: rgba(255,155,211,.55);
        transform: translateY(-2px);
        box-shadow: 0 20px 40px rgba(0,0,0,0.35);
      }

      .card.dragging {
        opacity: 0.7;
        transform: rotate(2deg) scale(0.98);
        z-index: 1000;
        box-shadow: 0 20px 40px rgba(255,155,211,.5);
        pointer-events: none;
        transition: none;
        border-color: rgba(255,155,211,.9);
      }

      .card.drag-over {
        border-color: rgba(255,155,211,.9);
        background: linear-gradient(180deg, rgba(255,155,211,.1), rgba(205,180,255,.05));
        transform: scale(1.02);
        box-shadow: 0 10px 25px rgba(255,155,211,.3);
      }

      .card h3 {
        margin: 0;
        font-size: 16px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        user-select: none;
        padding: 4px 8px;
        border-radius: 8px;
        transition: background-color 0.15s ease;
      }

      .card h3:hover {
        background-color: rgba(255,255,255,0.05);
      }

      .drag-handle {
        font-size: 16px;
        color: var(--muted);
        cursor: grab;
        opacity: 0.9;
        transition: all 0.15s ease;
        line-height: 1;
        padding: 8px 12px;
        border-radius: 8px;
        margin-left: 12px;
        touch-action: none;
        user-select: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        min-width: 32px;
        height: 28px;
        font-weight: bold;
        background: rgba(255,255,255,0.08);
        border: 1px solid rgba(255,255,255,0.15);
        position: relative;
        z-index: 10;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
      }

      /* ã‚¿ãƒƒãƒãƒ‡ãƒã‚¤ã‚¹ã§ã®æœ€é©åŒ– */
      @media (hover: none) and (pointer: coarse) {
        .drag-handle {
          font-size: 16px;
          padding: 4px 6px;
          opacity: 0.9;
        }
      }

      .drag-handle:hover {
        opacity: 1;
        background: rgba(255,155,211,0.2);
        border-color: rgba(255,155,211,0.4);
        color: rgba(255,155,211,0.9);
        transform: scale(1.05);
      }

      .card.dragging .drag-handle {
        cursor: grabbing;
        background: rgba(255,155,211,0.3);
        border-color: rgba(255,155,211,0.6);
        color: rgba(255,155,211,1);
      }
      .meta { display: flex; flex-wrap: wrap; gap: 6px; align-items: center; color: var(--muted); font-size: 12px; }
      .chip { background: linear-gradient(180deg, rgba(160,231,229,.16), rgba(205,180,255,.12)); border: 1px solid rgba(160,231,229,.35); padding: 3px 10px; border-radius: 999px; font-size: 11px; color: #e8f8ff; }
      .tags { display: flex; gap: 6px; flex-wrap: wrap; }
      .body { color: #d7dbff; font-size: 13px; white-space: pre-wrap; overflow: hidden; max-height: 12em; mask-image: linear-gradient(180deg, #000 80%, transparent); }
      .actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
        margin-top: 8px;
        padding-top: 8px;
        border-top: 1px solid rgba(255,255,255,0.1);
      }
      .left-actions {
        display: flex;
        gap: 6px;
        align-items: center;
      }
      .right-actions {
        display: flex;
        gap: 8px;
        align-items: center;
      }
      .icon-btn { cursor: pointer; border: 1px solid rgba(255,255,255,.22); background: rgba(255,255,255,.03); color: var(--muted); border-radius: 12px; padding: 6px 10px; font-size: 12px; display: inline-flex; align-items: center; gap: 6px; transition: background .15s ease, border-color .15s ease, color .15s ease, transform .05s ease; }
      .icon-btn:hover { background: rgba(255,255,255,0.08); }
      .icon-btn[data-active="true"] { color: #ffd86b; border-color: rgba(255,216,107,.55); background: rgba(255,216,107,0.15); }
      .icon-btn.danger { color: var(--danger); border-color: #5a2b35; background: #1f1116; }
      .copy-btn { margin-left: auto; width: 112px; text-align: center; }
      .inline-vars {
        display: grid;
        gap: 6px;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        margin-top: 4px;
      }
      .inline-vars .field label { font-size: 12px; }
      .inline-vars .field input { padding: 6px 8px; font-size: 12px; }
      .inline-vars {
        background: rgba(255,155,211,0.05);
        border: 1px dashed rgba(255,155,211,0.3);
        border-radius: 8px;
        padding: 12px;
        margin-top: 8px; /* ç©ºç™½ã‚’æ¸›ã‚‰ã™ */
      }
      .inline-vars .field {
        position: relative;
      }
      .inline-vars .field.required::after {
        content: '*';
        color: var(--danger);
        position: absolute;
        right: 8px;
        top: 8px;
        font-weight: bold;
      }
      .inline-vars .field.optional::after {
        content: '(ä»»æ„)';
        color: var(--muted);
        position: absolute;
        right: 8px;
        top: 8px;
        font-size: 11px;
      }

      .footer { margin-top: 26px; color: var(--muted); font-size: 12px; text-align: center; }

      dialog::backdrop { background: rgba(0,0,0,0.55); }
      dialog {
        border: 1px solid var(--border);
        border-radius: 14px;
        background: linear-gradient(180deg, #181d44, #12173b);
        color: var(--text);
        width: min(760px, 92vw);
        padding: 0;
        box-shadow: var(--shadow);
      }
      .modal-header { padding: 14px 16px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); }
      .modal-body { padding: 16px; display: grid; gap: 12px; }
      .field { display: grid; gap: 6px; }
      .field label { font-size: 13px; color: var(--muted); }
      .row { display: grid; gap: 10px; grid-template-columns: 1fr 1fr; }
      .modal-actions { display: flex; justify-content: flex-end; gap: 10px; padding: 14px 16px; border-top: 1px solid var(--border); }
      .help { font-size: 12px; color: var(--muted); }
      .vars-grid { display: grid; gap: 10px; grid-template-columns: 1fr 1fr; }
      .vars-grid .field input { width: 100%; }
      #varsPreview { width: 100%; resize: vertical; }

      .toast {
        position: fixed; right: 16px; bottom: 16px; background: #16213e; color: #e8f0ff;
        border: 1px solid #2a3a72; padding: 10px 14px; border-radius: 10px; box-shadow: var(--shadow);
        opacity: 0; transform: translateY(10px); transition: 0.2s ease; pointer-events: none;
      }
      .toast.show { opacity: 1; transform: translateY(0); }

      /* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ (480pxä»¥ä¸‹) */
      @media (max-width: 480px) {
        .container { padding: 16px 12px; }
        .card { padding: 12px; }
        .toolbar { padding: 8px; gap: 8px; }
        .title h1 { font-size: 20px; }
        .badge { font-size: 11px; padding: 3px 8px; }
        .controls { flex-direction: column; gap: 8px; }
        .btn { padding: 8px 12px; font-size: 13px; }
        .grid { gap: 12px; }
        .toast { left: 12px; right: 12px; bottom: 12px; }
      }

      /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆå¯¾å¿œ (481px-768px) */
      @media (max-width: 768px) {
        .grid { grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); }
        .toolbar { grid-template-columns: 1fr; gap: 12px; position: static; }
        header { grid-template-columns: 1fr; gap: 12px; }
        .row { grid-template-columns: 1fr; }
        .search { min-width: auto; }
        .switch { font-size: 12px; }
      }

      /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—å¯¾å¿œ (1025pxä»¥ä¸Š) */
      @media (min-width: 1025px) {
        .container { max-width: 1400px; }
        .grid { grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); }
        .toolbar { grid-template-columns: 1fr auto auto auto auto; }
      }

      /* ä¸­é–“ã‚µã‚¤ã‚ºå¯¾å¿œ (769px-1024px) */
      @media (min-width: 769px) and (max-width: 1024px) {
        .grid { grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); }
        .toolbar { grid-template-columns: 1fr auto auto; }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="title">
          <h1>PromptBox</h1>
          <span class="badge">ç”¨é€”åˆ¥ãƒ»ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã‚³ãƒ”ãƒ¼</span>
        </div>
        <div class="controls">
          <button id="openAdd" class="btn">ï¼‹ æ–°è¦è¿½åŠ </button>
          <button id="exportBtn" class="btn secondary">ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
          <button id="importBtn" class="btn ghost">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
          <input id="importFile" type="file" accept="application/json" hidden />
        </div>
      </header>

      <div class="toolbar">
        <div class="search">
          <input id="q" class="control" type="text" placeholder="æ¤œç´¢ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ãƒ»æœ¬æ–‡ãƒ»ã‚¿ã‚°ï¼‰" />
        </div>
        <select id="category" class="control">
          <option value="">ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒª</option>
        </select>
        <select id="sort" class="control">
          <option value="recent">ä¸¦ã³é †: è¿½åŠ ãŒæ–°ã—ã„é †</option>
          <option value="title">ä¸¦ã³é †: ã‚¿ã‚¤ãƒˆãƒ«</option>
          <option value="category">ä¸¦ã³é †: ã‚«ãƒ†ã‚´ãƒª</option>
          <option value="favorite">ä¸¦ã³é †: ãŠæ°—ã«å…¥ã‚Šå„ªå…ˆ</option>
        </select>
        <label class="switch"><input id="onlyFav" type="checkbox" /> ãŠæ°—ã«å…¥ã‚Šã®ã¿</label>
      </div>

      <div id="grid" class="grid"></div>

      <div class="footer">
        <span>ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã•ã‚Œã¾ã™ï¼ˆlocalStorageï¼‰ã€‚ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã§ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¯èƒ½ã€‚</span><br>
        <span style="font-size: 11px; color: var(--muted);">ğŸ’¡ ã‚¿ã‚¤ãƒˆãƒ«å³ã®â‹®â‹®ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã‚«ãƒ¼ãƒ‰ã®é †åºã‚’å¤‰æ›´ã§ãã¾ã™</span>
      </div>
    </div>

    <dialog id="addModal">
      <form method="dialog">
        <div class="modal-header">
          <strong>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è¿½åŠ </strong>
          <button type="button" id="closeAdd" class="icon-btn">é–‰ã˜ã‚‹</button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="field">
              <label for="addTitle">ã‚¿ã‚¤ãƒˆãƒ«</label>
              <input id="addTitle" class="control" type="text" placeholder="ä¾‹: ãƒã‚°ä¿®æ­£ã®ä¾é ¼ãƒ†ãƒ³ãƒ—ãƒ¬" required />
            </div>
            <div class="field">
              <label for="addCategory">ã‚«ãƒ†ã‚´ãƒª</label>
              <input id="addCategory" class="control" type="text" placeholder="ä¾‹: ãƒã‚°ä¿®æ­£" list="categoryList" />
              <datalist id="categoryList"></datalist>
            </div>
          </div>
          <div class="field">
            <label for="addTags">ã‚¿ã‚°ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label>
            <input id="addTags" class="control" type="text" placeholder="ä¾‹: bugfix, debug, steps" />
          </div>
          <div class="field">
            <label for="addBody">æœ¬æ–‡</label>
            <textarea id="addBody" class="control" rows="10" placeholder="ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ¬æ–‡ã‚’å…¥åŠ›" required></textarea>
          </div>
        </div>
        <div class="modal-actions">
          <button type="button" id="resetAdd" class="btn ghost">ã‚¯ãƒªã‚¢</button>
          <button type="submit" id="saveAdd" class="btn">ä¿å­˜</button>
        </div>
      </form>
    </dialog>

    <dialog id="editModal">
      <form method="dialog">
        <div class="modal-header">
          <strong>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç·¨é›†</strong>
          <button type="button" id="closeEdit" class="icon-btn">é–‰ã˜ã‚‹</button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="field">
              <label for="editTitle">ã‚¿ã‚¤ãƒˆãƒ«</label>
              <input id="editTitle" class="control" type="text" required />
            </div>
            <div class="field">
              <label for="editCategory">ã‚«ãƒ†ã‚´ãƒª</label>
              <input id="editCategory" class="control" type="text" list="categoryListEdit" />
              <datalist id="categoryListEdit"></datalist>
            </div>
          </div>
          <div class="field">
            <label for="editTags">ã‚¿ã‚°ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label>
            <input id="editTags" class="control" type="text" />
          </div>
          <div class="field">
            <label for="editBody">æœ¬æ–‡</label>
            <textarea id="editBody" class="control" rows="10" required></textarea>
          </div>
        </div>
        <div class="modal-actions">
          <button type="button" id="cancelEdit" class="btn ghost">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
          <button type="submit" id="saveEdit" class="btn">ä¿å­˜</button>
        </div>
      </form>
    </dialog>

    

    <div id="toast" class="toast" role="status" aria-live="polite"></div>

    <script>
      // ------------------------------
      // å‹ã®ç›®å®‰
      // Prompt = { id: string, title: string, category: string, tags: string[], body: string, favorite: boolean, createdAt: number }
      // ------------------------------

      const STORAGE_KEY = "promptBox.prompts.v1";

      /**
       * åˆæœŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆå¿…è¦ã«å¿œã˜ã¦è‡ªç”±ã«ç·¨é›†ã—ã¦ãã ã•ã„ï¼‰
       */
      const defaultPrompts = [
        {
          title: "ãƒã‚°å ±å‘Šãƒ†ãƒ³ãƒ—ãƒ¬ï¼ˆå¤‰æ•°ï¼‰",
          category: "ãƒã‚°ä¿®æ­£",
          tags: ["bug", "template", "vars"],
          body: `[ãƒã‚°ID] {{issue_id}}
[ã‚¿ã‚¤ãƒˆãƒ«] {{title}}
[å†ç¾æ‰‹é †]
{{steps}}

[æœŸå¾…çµæœ]
{{expected}}

[å®Ÿéš›ã®çµæœ]
{{actual}}

[å„ªå…ˆåº¦] {{priority|normal}}`,
        },
        {
          title: "PRãƒ¬ãƒ“ãƒ¥ãƒ¼ä¾é ¼ï¼ˆå¤‰æ•°ï¼‰",
          category: "ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼",
          tags: ["review", "pr", "vars"],
          body: `PR: {{pr_url}}
å¯¾è±¡ç¯„å›²: {{scope}}
é‡ç‚¹ç¢ºèª: {{focus|èª­ã¿ã‚„ã™ã•, ãƒ†ã‚¹ãƒˆ, å½±éŸ¿ç¯„å›²}}
è£œè¶³: {{notes|ãªã—}}`,
        },
        {
          title: "ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆç”Ÿæˆï¼ˆå¤‰æ•°ï¼‰",
          category: "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ",
          tags: ["release", "notes", "vars"],
          body: `ãƒãƒ¼ã‚¸ãƒ§ãƒ³: {{version}}
æ—¥ä»˜: {{date|YYYY-MM-DD}}
å¤‰æ›´ç‚¹:
{{changes}}

æ—¢çŸ¥ã®å•é¡Œ: {{known_issues|ãªã—}}`,
        },
        {
          title: "æ±ç”¨ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¾é ¼",
          category: "ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸€èˆ¬",
          tags: ["coding", "implementation"],
          body: `æ¬¡ã®ä»•æ§˜ã‚’æº€ãŸã™ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚
è¦ä»¶:
- æ©Ÿèƒ½:
- å…¥åŠ›/å‡ºåŠ›:
- å¢ƒç•Œæ¡ä»¶:
å“è³ª:
- å¯èª­æ€§ã‚’é‡è¦–ã—ã€æ„å‘³ã®ã‚ã‚‹å‘½åã‚’å¾¹åº•ã™ã‚‹
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒ­ã‚°å‡ºåŠ›ã‚’å®Ÿè£…ã™ã‚‹
è¿½åŠ :
- å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆæ­£å¸¸ç³»/ç•°å¸¸ç³»ï¼‰ã‚‚ä½œæˆã™ã‚‹`,
        },
        {
          title: "ãƒã‚°ä¿®æ­£ãƒ†ãƒ³ãƒ—ãƒ¬",
          category: "ãƒã‚°ä¿®æ­£",
          tags: ["bugfix", "debug"],
          body: `æ¬¡ã®ä¸å…·åˆã‚’åŸå› ç‰¹å®šã—ã€ä¿®æ­£æ¡ˆã‚’æç¤ºã—ã¦ãã ã•ã„ã€‚
ç—‡çŠ¶:
å†ç¾æ‰‹é †:
æœŸå¾…çµæœ:
ãƒ­ã‚°/ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹:
åˆ¶ç´„:
- æ—¢å­˜ã®å…¬é–‹APIã¯å¤‰æ›´ã—ãªã„
å‡ºåŠ›:
- åŸå› å€™è£œã®ãƒªã‚¹ãƒˆã¨å†ç¾æ¡ä»¶
- ä¿®æ­£æ–¹é‡ï¼ˆå½±éŸ¿ç¯„å›²ã€ä»£æ›¿æ¡ˆï¼‰
- æœ€å°ä¿®æ­£ã®ã‚³ãƒ¼ãƒ‰ä¾‹`,
        },
        {
          title: "å®‰å…¨ãªãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°è¨ˆç”»",
          category: "ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°",
          tags: ["refactor", "design"],
          body: `ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿ã‚„ã™ã•ã¨æ‹¡å¼µæ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ã«ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã—ã¦ãã ã•ã„ã€‚
æ¡ä»¶:
- ãµã‚‹ã¾ã„ã¯å¤‰æ›´ã—ãªã„
- é–¢æ•°ã¯çŸ­ãã€æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ã‚’ä½¿ã†
- å‘½åã¯ãƒ‰ãƒ¡ã‚¤ãƒ³èªå½™ã§æ˜ç¢ºã«
å‡ºåŠ›:
- èª²é¡Œã®åˆ—æŒ™
- ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®ã‚¹ãƒ†ãƒƒãƒ—åˆ†è§£
- ãƒªã‚¹ã‚¯ã¨ãƒ†ã‚¹ãƒˆè¦³ç‚¹
- å¤‰æ›´å¾Œã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰`,
        },
        {
          title: "READMEãƒ‰ãƒ©ãƒ•ãƒˆç”Ÿæˆ",
          category: "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ",
          tags: ["docs", "readme"],
          body: `ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®READMEã®è‰æ¡ˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
å«ã‚ã‚‹é …ç›®:
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ / ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆï¼ˆä»»æ„ï¼‰
- ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— / å¿…è¦è¦ä»¶
- ä½¿ã„æ–¹ï¼ˆã‚³ãƒãƒ³ãƒ‰/è¨­å®šä¾‹ï¼‰
- è¨­è¨ˆã®è¦ç‚¹ / ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ
- ãƒ†ã‚¹ãƒˆ / CI
- ãƒ©ã‚¤ã‚»ãƒ³ã‚¹
ãƒˆãƒ¼ãƒ³: åˆå­¦è€…ã«ã‚‚é…æ…®ã—ã¤ã¤ç°¡æ½”`,
        },
        {
          title: "ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆç”Ÿæˆ",
          category: "ãƒ†ã‚¹ãƒˆ",
          tags: ["test", "unit"],
          body: `å¯¾è±¡ã‚³ãƒ¼ãƒ‰ã®å˜ä½“ãƒ†ã‚¹ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
å‰æ:
- ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯:
- è¦³ç‚¹: æ­£å¸¸ç³»/å¢ƒç•Œå€¤/ç•°å¸¸ç³»
å‡ºåŠ›:
- ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä¸€è¦§ï¼ˆå…¥åŠ›/æœŸå¾…/ç›®çš„ï¼‰
- å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã¨ãƒ¢ãƒƒã‚¯æ–¹é‡
- å®Ÿè¡Œæ–¹æ³•`,
        },
        {
          title: "ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•´å½¢ï¼ˆConventional Commitsï¼‰",
          category: "Git/ã‚³ãƒŸãƒƒãƒˆ",
          tags: ["git", "commit"],
          body: `å¤‰æ›´å†…å®¹ã‚’Conventional Commitsã®å½¢å¼ã§è¦ç´„ã—ã¦ãã ã•ã„ã€‚
å…¥åŠ›: å¤‰æ›´ç‚¹ã®ç®‡æ¡æ›¸ã
å‡ºåŠ›: type(scope)!: subject ã¨ãƒœãƒ‡ã‚£ï¼ˆç†ç”±/å½±éŸ¿/ç§»è¡Œï¼‰
æ³¨æ„: æ—¥æœ¬èªã§ç°¡æ½”ã«`,
        },
        {
          title: "ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¾é ¼ãƒ†ãƒ³ãƒ—ãƒ¬",
          category: "ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼",
          tags: ["review", "pr"],
          body: `ã“ã®å·®åˆ†ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼è¦³ç‚¹ã‚’ææ¡ˆã—ã¦ãã ã•ã„ã€‚
å‰æ: ç›®çš„/èƒŒæ™¯/æ–¹é‡/åˆ¶ç´„
è¦³ç‚¹ä¾‹: æ­£ã—ã•/èª­ã¿ã‚„ã™ã•/è²¬å‹™åˆ†é›¢/å‘½å/ãƒ†ã‚¹ãƒˆ/æ€§èƒ½/ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£/å½±éŸ¿ç¯„å›²
å‡ºåŠ›: ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã¨é‡ç‚¹ç¢ºèªãƒã‚¤ãƒ³ãƒˆ`,
        },
        {
          title: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã¨å—ã‘å…¥ã‚ŒåŸºæº–",
          category: "ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆä»•æ§˜",
          tags: ["spec", "ux"],
          body: `è¦æ±‚ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã¨å—ã‘å…¥ã‚ŒåŸºæº–ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:
As a [ãƒ¦ãƒ¼ã‚¶ãƒ¼], I want [ä¾¡å€¤], so that [ç›®çš„].
å—ã‘å…¥ã‚ŒåŸºæº–: Gherkiné¢¨ã«Given/When/Then`,
        },
        {
          title: "æŠ€è¡“æ–‡æ›¸ã®è¦ç´„ã¨å¹³æ˜“åŒ–",
          category: "ç¿»è¨³/è¦ç´„",
          tags: ["summary", "simplify"],
          body: `ä»¥ä¸‹ã®æŠ€è¡“æ–‡æ›¸ã‚’ã€éã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ã‚‚ä¼ã‚ã‚‹ã‚ˆã†ã«è¦ç´„ã—ã¦ãã ã•ã„ã€‚
æ¡ä»¶:
- å°‚é–€ç”¨èªã«ã¯ç°¡æ½”ãªè£œè¶³ã‚’æ·»ãˆã‚‹
- æ¯”å–©ã¯æ§ãˆã‚ã«å…·ä½“ä¾‹ã‚’
å‡ºåŠ›: ç®‡æ¡æ›¸ãï¼‹100å­—è¦ç´„`,
        },
        {
          title: "SQLæœ€é©åŒ–ã‚¢ãƒ‰ãƒã‚¤ã‚¹",
          category: "ãƒ‡ãƒ¼ã‚¿/SQL",
          tags: ["sql", "performance"],
          body: `ä»¥ä¸‹ã®SQLã‚’æ€§èƒ½é¢ã‹ã‚‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã€æœ€é©åŒ–æ¡ˆã‚’æç¤ºã—ã¦ãã ã•ã„ã€‚
å‡ºåŠ›:
- å®Ÿè¡Œè¨ˆç”»ä¸Šã®æ‡¸å¿µ
- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æˆ¦ç•¥
- å†è¨­è¨ˆæ¡ˆï¼ˆæ­£è¦åŒ–/éæ­£è¦åŒ–/åˆ†å‰²ï¼‰
- å®‰å…¨ãªæ®µéšçš„ç§»è¡Œæ¡ˆ`,
        },
        {
          title: "æ­£è¦è¡¨ç¾ä½œæˆæ”¯æ´",
          category: "æ­£è¦è¡¨ç¾",
          tags: ["regex"],
          body: `è¦ä»¶ã‚’æº€ãŸã™æ­£è¦è¡¨ç¾ã‚’è¨­è¨ˆã—ã€ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’æç¤ºã—ã¦ãã ã•ã„ã€‚
è¦ä»¶:
- ãƒãƒƒãƒä¾‹/éãƒãƒƒãƒä¾‹
- ãƒ•ãƒ©ã‚°/ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã®æ„å›³
å‡ºåŠ›: æ­£è¦è¡¨ç¾ / èª¬æ˜ / ä»£è¡¨ãƒ†ã‚¹ãƒˆ`,
        },
        {
          title: "ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ”¹å–„",
          category: "ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ",
          tags: ["prompt", "improve"],
          body: `ä»¥ä¸‹ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã€æ›–æ˜§ã•ã‚’æ¸›ã‚‰ã—å†ç¾æ€§ã‚’é«˜ã‚ã‚‹å½¢ã«æ›¸ãç›´ã—ã¦ãã ã•ã„ã€‚
å‡ºåŠ›:
- æ”¹å–„ç‰ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
- å¤‰æ›´æ„å›³ï¼ˆã‚¹ã‚³ãƒ¼ãƒ—/åˆ¶ç´„/å‡ºåŠ›å½¢å¼ï¼‰
- æˆåŠŸåŸºæº–`,
        },
      ].map((p, i) => ({ id: cryptoRandomId(), favorite: false, createdAt: Date.now() + i, ...p }));

      // æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚‚ä¸€åº¦ã ã‘å¤‰æ•°ã‚µãƒ³ãƒ—ãƒ«ã‚’é…å¸ƒ
      const MIGRATION_PLACEHOLDER_SAMPLES = "promptBox.migration.placeholderSamples.v1";

      // ------------------------------
      // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
      // ------------------------------
      function cryptoRandomId() {
        if (window.crypto?.randomUUID) return window.crypto.randomUUID();
        return 'id-' + Math.random().toString(36).slice(2) + Date.now().toString(36);
      }

      // ãƒ‰ãƒ©ãƒƒã‚°æ“ä½œã®ãƒ‡ãƒãƒƒã‚°ç”¨é–¢æ•°
      function logDragEvent(eventType, details = {}) {
        console.log(`[ãƒ‰ãƒ©ãƒƒã‚°ãƒ‡ãƒãƒƒã‚°] ${eventType}:`, {
          timestamp: new Date().toISOString(),
          ...details
        });
      }

      // ãƒ‰ãƒ©ãƒƒã‚°ãƒ‡ãƒ¼ã‚¿ã‚’å®‰å…¨ã«ä¿æŒã™ã‚‹ãŸã‚ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
      let currentDragData = null;

      function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }

      function saveToStorage(prompts) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(prompts));
      }

      function loadFromStorage() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return null;
          const parsed = JSON.parse(raw);
          if (!Array.isArray(parsed)) return null;
          return parsed;
        } catch { return null; }
      }

      // ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã®ã‚­ãƒ¥ãƒ¼ç®¡ç†
      let toastQueue = [];
      let isToastShowing = false;

      function showToast(message) {
        toastQueue.push(message);
        processToastQueue();
      }

      function processToastQueue() {
        if (isToastShowing || toastQueue.length === 0) return;

        isToastShowing = true;
        const message = toastQueue.shift();
        const el = document.getElementById('toast');

        el.textContent = message;
        el.setAttribute('aria-live', 'assertive');
        el.setAttribute('aria-atomic', 'true');
        el.classList.add('show');

        setTimeout(() => {
          el.classList.remove('show');
          el.removeAttribute('aria-live');
          el.removeAttribute('aria-atomic');
          isToastShowing = false;

          // ã‚­ãƒ¥ãƒ¼ã«æ¬¡ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚Œã°å‡¦ç†
          if (toastQueue.length > 0) {
            setTimeout(processToastQueue, 200);
          }
        }, 1500);
      }

      async function copyToClipboard(text) {
        try {
          if (navigator.clipboard?.writeText) {
            await navigator.clipboard.writeText(text);
          } else {
            const ta = document.createElement('textarea');
            ta.value = text; document.body.appendChild(ta); ta.select();
            document.execCommand('copy'); document.body.removeChild(ta);
          }
          showToast('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
        } catch (e) {
          console.error(e);
          showToast('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
      }

      // å¤‰æ•°å±•é–‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
      function extractVariables(template) {
        const regex = /\{\{\s*([^\}\s\|]+)(?:\|([^}]*))?\s*\}\}/g;
        const map = new Map();
        let m;
        while ((m = regex.exec(template))) {
          const name = m[1];
          const def = m[2] ?? '';
          if (!map.has(name)) map.set(name, def);
        }
        return map; // Map<name, default>
      }

      function applyVariables(template, values) {
        return template.replace(/\{\{\s*([^\}\s\|]+)(?:\|([^}]*))?\s*\}\}/g, (all, name, def) => {
          const v = values[name];
          if (v == null || v === '') return def ?? '';
          return String(v);
        });
      }

      function hasAllVariablesFilled(template, values) {
        const map = extractVariables(template);
        for (const [name, def] of map.entries()) {
          const v = values[name];
          if ((v == null || v === '') && (def == null || def === '')) return false;
        }
        return true;
      }

      // ------------------------------
      // çŠ¶æ…‹
      // ------------------------------
      let prompts = loadFromStorage() ?? defaultPrompts;
      if (!loadFromStorage()) {
        // åˆå›èµ·å‹•: ãã®ã¾ã¾ä¿å­˜
        saveToStorage(prompts);
      } else {
        // æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼: ã‚µãƒ³ãƒ—ãƒ«æœªæŠ•å…¥ãªã‚‰è¿½è¨˜
        try {
          const migrated = localStorage.getItem(MIGRATION_PLACEHOLDER_SAMPLES);
          if (!migrated) {
            const samples = defaultPrompts.filter(p => p.tags?.includes('vars'));
            if (samples.length) {
              prompts = [...samples.map(s => ({ ...s, id: cryptoRandomId(), createdAt: Date.now() })), ...prompts];
              saveToStorage(prompts);
            }
            localStorage.setItem(MIGRATION_PLACEHOLDER_SAMPLES, '1');
          }
        } catch {}
      }

      const state = {
        query: '',
        category: '',
        onlyFavorite: false,
        sort: 'recent',
      };

      // ------------------------------
      // æç”»
      // ------------------------------
      const grid = document.getElementById('grid');
      const categorySelect = document.getElementById('category');
      const sortSelect = document.getElementById('sort');
      const onlyFavInput = document.getElementById('onlyFav');
      const qInput = document.getElementById('q');

      function renderCategoryOptions() {
        const categories = Array.from(new Set(prompts.map(p => p.category))).sort((a, b) => a.localeCompare(b, 'ja'));
        const list = document.getElementById('categoryList');
        const listEdit = document.getElementById('categoryListEdit');
        list.innerHTML = '';
        if (listEdit) listEdit.innerHTML = '';
        categorySelect.innerHTML = '<option value="">ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒª</option>';
        categories.forEach(c => {
          const opt = document.createElement('option'); opt.value = c; opt.textContent = c; categorySelect.appendChild(opt);
          const dataOpt = document.createElement('option'); dataOpt.value = c; list.appendChild(dataOpt);
          if (listEdit) {
            const dataOpt2 = document.createElement('option'); dataOpt2.value = c; listEdit.appendChild(dataOpt2);
          }
        });
        if (state.category && !categories.includes(state.category)) state.category = '';
      }

      function normalize(text) {
        return (text || '').toLowerCase();
      }

      function filterAndSort(items) {
        const q = normalize(state.query);
        let result = items.filter(p => {
          if (state.category && p.category !== state.category) return false;
          if (state.onlyFavorite && !p.favorite) return false;
          if (!q) return true;
          const inTitle = normalize(p.title).includes(q);
          const inBody = normalize(p.body).includes(q);
          const inTags = (p.tags || []).some(t => normalize(t).includes(q));
          const inCategory = normalize(p.category).includes(q);
          return inTitle || inBody || inTags || inCategory;
        });

        switch (state.sort) {
          case 'title':
            result.sort((a, b) => a.title.localeCompare(b.title, 'ja'));
            break;
          case 'category':
            result.sort((a, b) => a.category.localeCompare(b.category, 'ja') || a.title.localeCompare(b.title, 'ja'));
            break;
          case 'favorite':
            result.sort((a, b) => Number(b.favorite) - Number(a.favorite) || b.createdAt - a.createdAt);
            break;
          case 'recent':
          default:
            result.sort((a, b) => b.createdAt - a.createdAt);
        }
        return result;
      }

      function createCard(p) {
        const card = document.createElement('div');
        card.className = 'card';
        const title = document.createElement('h3');
        title.textContent = p.title;
        title.style.cursor = 'grab';
        title.style.userSelect = 'none'; // ãƒ†ã‚­ã‚¹ãƒˆé¸æŠã‚’é˜²æ­¢

        // ãƒ‰ãƒ©ãƒƒã‚°ãƒãƒ³ãƒ‰ãƒ«ã‚’è¿½åŠ 
        const dragHandle = document.createElement('div');
        dragHandle.className = 'drag-handle';
        dragHandle.innerHTML = 'â‹®â‹®';
        dragHandle.title = 'ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ä¸¦ã¹æ›¿ãˆ';
        dragHandle.draggable = true;
        title.appendChild(dragHandle);

        card.dataset.id = p.id;
        card.draggable = true; // ã‚«ãƒ¼ãƒ‰å…¨ä½“ã‚’ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ã«

        // ãƒ‰ãƒ©ãƒƒã‚°ãƒãƒ³ãƒ‰ãƒ«ã‹ã‚‰ã‚‚ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½
        dragHandle.draggable = true;

        // ãƒ‰ãƒ©ãƒƒã‚°ãƒãƒ³ãƒ‰ãƒ«ã®ãƒã‚¦ã‚¹ãƒ€ã‚¦ãƒ³ã‚’ç¢ºå®Ÿã«ã‚­ãƒ£ãƒ—ãƒãƒ£
        dragHandle.addEventListener('mousedown', (e) => {
          if (e.button === 0) { // å·¦ã‚¯ãƒªãƒƒã‚¯ã®ã¿
            logDragEvent('ãƒ‰ãƒ©ãƒƒã‚°ãƒãƒ³ãƒ‰ãƒ«mousedown', { cardId: p.id, button: e.button });
            e.preventDefault();
            e.stopPropagation();
          }
        });
        // ãƒ‰ãƒ©ãƒƒã‚°ãƒãƒ³ãƒ‰ãƒ«ã‹ã‚‰ã®ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹
        dragHandle.addEventListener('dragstart', (e) => {
          // å·¦ã‚¯ãƒªãƒƒã‚¯ã®ã¿è¨±å¯
          if (e.button !== 0) {
            logDragEvent('ãƒãƒ³ãƒ‰ãƒ«ãƒ‰ãƒ©ãƒƒã‚°æ‹’å¦', { button: e.button, reason: 'å·¦ã‚¯ãƒªãƒƒã‚¯ä»¥å¤–' });
            e.preventDefault();
            return;
          }

          logDragEvent('ãƒãƒ³ãƒ‰ãƒ«ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹', { cardId: p.id, button: e.button });

          // é‡è¦ãªä¿®æ­£: ãƒ‡ãƒ¼ã‚¿ã‚’è¤‡æ•°ã®æ–¹æ³•ã§ä¿å­˜
          e.dataTransfer.clearData();

          // è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿å½¢å¼ã§ä¿å­˜ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§ã®ãŸã‚ï¼‰
          const dragData = JSON.stringify({ id: p.id, type: 'card', timestamp: Date.now() });
          e.dataTransfer.setData('text/plain', p.id);
          e.dataTransfer.setData('application/json', dragData);
          e.dataTransfer.effectAllowed = 'move';

          // ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãè¨­å®šã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
          logDragEvent('ãƒ‡ãƒ¼ã‚¿è¨­å®šç¢ºèª', {
            cardId: p.id,
            plainText: e.dataTransfer.getData('text/plain'),
            jsonData: e.dataTransfer.getData('application/json'),
            types: Array.from(e.dataTransfer.types)
          });

          // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ã‚‚ä¿å­˜ï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰
          currentDragData = p.id;

          card.classList.add('dragging');
          card.dataset.dragging = 'handle';

          // ã‚¤ãƒ™ãƒ³ãƒˆä¼æ’­ã‚’å®Œå…¨ã«åœæ­¢ï¼ˆdataTransferæ“ä½œå¾Œï¼‰
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();
        });

        dragHandle.addEventListener('dragend', () => {
          card.classList.remove('dragging');
          delete card.dataset.dragging;
        });

        // ã‚¿ã‚¤ãƒˆãƒ«å…¨ä½“ã‚‚ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ã«
        title.draggable = true;
        title.addEventListener('dragstart', (e) => {
          // ãƒ‰ãƒ©ãƒƒã‚°ãƒãƒ³ãƒ‰ãƒ«ã‹ã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆã®ã¿è¨±å¯
          if (!e.target.closest('.drag-handle')) {
            logDragEvent('ã‚¿ã‚¤ãƒˆãƒ«ãƒ‰ãƒ©ãƒƒã‚°æ‹’å¦', {
              reason: 'ãƒ‰ãƒ©ãƒƒã‚°ãƒãƒ³ãƒ‰ãƒ«ä»¥å¤–ã‹ã‚‰ã®ãƒ‰ãƒ©ãƒƒã‚°',
              target: e.target.tagName,
              cardId: p.id
            });
            e.preventDefault();
            return;
          }

          // å·¦ã‚¯ãƒªãƒƒã‚¯ã®ã¿è¨±å¯
          if (e.button !== 0) {
            logDragEvent('ã‚¿ã‚¤ãƒˆãƒ«ãƒ‰ãƒ©ãƒƒã‚°æ‹’å¦', { button: e.button, reason: 'å·¦ã‚¯ãƒªãƒƒã‚¯ä»¥å¤–' });
            e.preventDefault();
            return;
          }

          logDragEvent('ã‚¿ã‚¤ãƒˆãƒ«ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹', { cardId: p.id, button: e.button });

          // é‡è¦ãªä¿®æ­£: ãƒ‡ãƒ¼ã‚¿ã‚’è¤‡æ•°ã®æ–¹æ³•ã§ä¿å­˜
          e.dataTransfer.clearData();

          // è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿å½¢å¼ã§ä¿å­˜ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§ã®ãŸã‚ï¼‰
          const dragData = JSON.stringify({ id: p.id, type: 'card', timestamp: Date.now() });
          e.dataTransfer.setData('text/plain', p.id);
          e.dataTransfer.setData('application/json', dragData);
          e.dataTransfer.effectAllowed = 'move';

          // ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãè¨­å®šã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
          logDragEvent('ã‚¿ã‚¤ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿è¨­å®šç¢ºèª', {
            cardId: p.id,
            plainText: e.dataTransfer.getData('text/plain'),
            jsonData: e.dataTransfer.getData('application/json'),
            types: Array.from(e.dataTransfer.types)
          });

          // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ã‚‚ä¿å­˜ï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰
          currentDragData = p.id;

          card.classList.add('dragging');
          card.dataset.dragging = 'title';

          // ã‚¤ãƒ™ãƒ³ãƒˆä¼æ’­ã‚’å®Œå…¨ã«åœæ­¢ï¼ˆdataTransferæ“ä½œå¾Œï¼‰
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();
        });

        title.addEventListener('dragend', () => {
          card.classList.remove('dragging');
          delete card.dataset.dragging;
        });

        const meta = document.createElement('div');
        meta.className = 'meta';
        const cat = document.createElement('span'); cat.className = 'chip'; cat.textContent = p.category || 'æœªåˆ†é¡';
        const tags = document.createElement('div'); tags.className = 'tags';
        (p.tags || []).forEach(t => { const s = document.createElement('span'); s.className = 'chip'; s.textContent = `#${t}`; tags.appendChild(s); });
        meta.appendChild(cat); meta.appendChild(tags);

        // ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³å¤‰æ•°å…¥åŠ›
        const varsMap = extractVariables(p.body);

        const body = document.createElement('div');
        body.className = 'body';
        body.textContent = p.body;

        // å¤‰æ•°ãŒãªã„å ´åˆã¯æœ¬æ–‡è¡¨ç¤ºã‚’æ‹¡å¼µ
        if (varsMap.size === 0) {
          body.style.maxHeight = '16em'; // å¤‰æ•°ãŒãªã„å ´åˆã¯ã‚ˆã‚Šå¤šãã®è¡Œã‚’è¡¨ç¤º
        } else {
          body.style.maxHeight = '12em'; // å¤‰æ•°ãŒã‚ã‚‹å ´åˆã‚‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚ˆã‚Šå¤šãè¡¨ç¤º
        }
        let inlineValues = {};
        let inputsReady = varsMap.size === 0;
        let varsContainer = null;
        if (varsMap.size > 0) {
          varsContainer = document.createElement('div');
          varsContainer.className = 'inline-vars';
          varsMap.forEach((def, name) => {
            const wrap = document.createElement('div');
            wrap.className = def ? 'field optional' : 'field required';
            const label = document.createElement('label');
            label.textContent = name;
            const input = document.createElement('input');
            input.className = 'control';
            input.type = 'text';
            input.placeholder = def ? `æ—¢å®š: ${def}` : `${name} ã‚’å…¥åŠ›`;
            input.value = '';
            input.addEventListener('input', () => {
              inlineValues[name] = input.value;
              updateCopyAvailability();
            });
            wrap.appendChild(label);
            wrap.appendChild(input);
            varsContainer.appendChild(wrap);
          });
        }

        const actions = document.createElement('div');
        actions.className = 'actions';

        const left = document.createElement('div'); left.className = 'left-actions';
        const fav = document.createElement('button');
        fav.className = 'icon-btn';
        fav.setAttribute('aria-label', p.favorite ? 'ãŠæ°—ã«å…¥ã‚Šã‹ã‚‰å‰Šé™¤' : 'ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ ');
        fav.setAttribute('aria-pressed', String(Boolean(p.favorite)));
        fav.title = p.favorite ? 'ãŠæ°—ã«å…¥ã‚Šã‹ã‚‰å‰Šé™¤' : 'ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ ';
        fav.dataset.active = String(Boolean(p.favorite));
        fav.textContent = p.favorite ? 'â˜…' : 'â˜†';
        fav.addEventListener('click', () => {
          p.favorite = !p.favorite;
          fav.dataset.active = String(Boolean(p.favorite));
          fav.textContent = p.favorite ? 'â˜…' : 'â˜†';
          saveToStorage(prompts);
          if (state.onlyFavorite) render();
        });

        const expand = document.createElement('button');
        expand.className = 'icon-btn';
        expand.setAttribute('aria-label', 'æœ¬æ–‡ã®è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ');
        expand.setAttribute('aria-expanded', 'false');
        expand.textContent = 'å…¨æ–‡è¡¨ç¤º';
        let expanded = false;
        expand.addEventListener('click', () => {
          expanded = !expanded;
          expand.setAttribute('aria-expanded', String(expanded));
          if (expanded) {
            body.style.maxHeight = 'unset';
            body.style.maskImage = 'none';
            expand.textContent = 'æŠ˜ã‚ŠãŸãŸã‚€';
            expand.setAttribute('aria-label', 'æœ¬æ–‡ã‚’æŠ˜ã‚ŠãŸãŸã‚€');
          } else {
            // å¤‰æ•°ãŒãªã„å ´åˆã¯ã‚ˆã‚Šå¤šãã®è¡Œã‚’è¡¨ç¤º
            body.style.maxHeight = varsMap.size === 0 ? '16em' : '12em';
            body.style.maskImage = 'linear-gradient(180deg, #000 80%, transparent)';
            expand.textContent = 'å…¨æ–‡è¡¨ç¤º';
            expand.setAttribute('aria-label', 'æœ¬æ–‡ã‚’å±•é–‹');
          }
        });

        left.appendChild(fav);
        left.appendChild(expand);

        const copy = document.createElement('button');
        copy.className = 'btn copy-btn';
        copy.textContent = 'ã‚³ãƒ”ãƒ¼';
        copy.style.minWidth = '92px';
        function updateCopyAvailability() {
          if (varsMap.size === 0) {
            copy.disabled = false;
            copy.title = '';
            return;
          }
          const ready = hasAllVariablesFilled(p.body, inlineValues);
          copy.disabled = !ready;
          copy.title = ready ? '' : 'ã™ã¹ã¦ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ã«å…¥åŠ›ã—ã¦ãã ã•ã„';
        }
        updateCopyAvailability();
        copy.addEventListener('click', async () => {
          const template = p.body;
          const text = varsMap.size > 0 ? applyVariables(template, inlineValues) : template;
          copy.disabled = true;
          try {
            await copyToClipboard(text);
            const oldText = copy.textContent;
            copy.textContent = 'ã‚³ãƒ”ãƒ¼æ¸ˆã¿';
            copy.classList.add('copied');
            setTimeout(() => {
              copy.classList.remove('copied');
              copy.textContent = oldText;
              copy.disabled = false;
              updateCopyAvailability();
            }, 900);
          } catch (e) {
            const oldText = copy.textContent;
            copy.textContent = 'ã‚³ãƒ”ãƒ¼å¤±æ•—';
            copy.classList.add('failed');
            setTimeout(() => {
              copy.classList.remove('failed');
              copy.textContent = oldText;
              copy.disabled = false;
              updateCopyAvailability();
            }, 1200);
          }
        });

        const del = document.createElement('button');
        del.className = 'icon-btn danger';
        del.textContent = 'å‰Šé™¤';
        del.setAttribute('aria-label', `${p.title}ã‚’å‰Šé™¤`);
        del.addEventListener('click', () => {
          if (!confirm('ã“ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
          prompts = prompts.filter(x => x.id !== p.id);
          saveToStorage(prompts);
          render();
          showToast('å‰Šé™¤ã—ã¾ã—ãŸ');
        });

        const edit = document.createElement('button');
        edit.className = 'icon-btn';
        edit.textContent = 'ç·¨é›†';
        edit.setAttribute('aria-label', `${p.title}ã‚’ç·¨é›†`);
        edit.addEventListener('click', () => openEditModal(p));

        // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¨ãƒªã‚¢ã‚’å†æ§‹æˆ
        const right = document.createElement('div');
        right.className = 'right-actions';
        right.appendChild(copy);

        // å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’å³å´ã«ç§»å‹•ï¼ˆèª¤æ“ä½œé˜²æ­¢ï¼‰
        right.appendChild(del);
        right.appendChild(edit);

        actions.appendChild(left);
        actions.appendChild(right);

        card.appendChild(title);
        card.appendChild(meta);
        card.appendChild(body);
        if (varsContainer) card.appendChild(varsContainer);
        card.appendChild(actions);

        // ã‚«ãƒ¼ãƒ‰å…¨ä½“ã®ãƒã‚¦ã‚¹ãƒ€ã‚¦ãƒ³ã‚’ç¢ºå®Ÿã«ã‚­ãƒ£ãƒ—ãƒãƒ£ï¼ˆãƒ‰ãƒ©ãƒƒã‚°ãƒãƒ³ãƒ‰ãƒ«é™¤ãï¼‰
        card.addEventListener('mousedown', (e) => {
          // ãƒ‰ãƒ©ãƒƒã‚°ãƒãƒ³ãƒ‰ãƒ«ã‹ã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆã¯å‡¦ç†ã—ãªã„
          if (e.target.closest('.drag-handle') || e.target.closest('h3')) {
            return;
          }

          // ã‚¯ãƒªãƒƒã‚¯å¯èƒ½è¦ç´ ã‹ã‚‰ã®ãƒ‰ãƒ©ãƒƒã‚°ã¯æ‹’å¦
          if (e.target.closest('button, a, .icon-btn, .btn')) {
            logDragEvent('ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯è¦ç´ mousedown', {
              target: e.target.tagName,
              cardId: p.id
            });
            e.preventDefault();
            e.stopPropagation();
            return;
          }

          if (e.button === 0) {
            logDragEvent('ã‚«ãƒ¼ãƒ‰mousedown', { cardId: p.id, button: e.button });
            e.preventDefault();
            e.stopPropagation();
          }
        });

        // ã‚«ãƒ¼ãƒ‰å…¨ä½“ã§ã‚‚ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ã«ï¼ˆãƒ‰ãƒ©ãƒƒã‚°ãƒãƒ³ãƒ‰ãƒ«ä»¥å¤–ã®å ´åˆï¼‰
        card.addEventListener('dragstart', (e) => {
          // å·¦ã‚¯ãƒªãƒƒã‚¯ã®ã¿è¨±å¯
          if (e.button !== 0) {
            logDragEvent('ã‚«ãƒ¼ãƒ‰ãƒ‰ãƒ©ãƒƒã‚°æ‹’å¦', { button: e.button, reason: 'å·¦ã‚¯ãƒªãƒƒã‚¯ä»¥å¤–' });
            e.preventDefault();
            return;
          }

          // æ—¢ã«ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®å ´åˆã¯å‡¦ç†ã—ãªã„
          if (card.dataset.dragging) {
            logDragEvent('ã‚«ãƒ¼ãƒ‰ãƒ‰ãƒ©ãƒƒã‚°ã‚¹ã‚­ãƒƒãƒ—', { reason: 'æ—¢ã«ãƒ‰ãƒ©ãƒƒã‚°ä¸­', cardId: p.id });
            return;
          }

          // ãƒ‰ãƒ©ãƒƒã‚°ãƒãƒ³ãƒ‰ãƒ«ã‚„ã‚¿ã‚¤ãƒˆãƒ«ã‹ã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆã®å ´åˆã¯å‡¦ç†ã—ãªã„
          if (e.target === dragHandle || e.target === title || e.target.closest('.drag-handle') || e.target.closest('h3')) {
            logDragEvent('ã‚«ãƒ¼ãƒ‰ãƒ‰ãƒ©ãƒƒã‚°ã‚¹ã‚­ãƒƒãƒ—', {
              reason: 'ãƒãƒ³ãƒ‰ãƒ«/ã‚¿ã‚¤ãƒˆãƒ«ã‹ã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆ',
              target: e.target.tagName,
              cardId: p.id
            });
            return;
          }

          // ã‚«ãƒ¼ãƒ‰å†…ã®ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ãªè¦ç´ ï¼ˆãƒœã‚¿ãƒ³ã€ãƒªãƒ³ã‚¯ãªã©ï¼‰ã‹ã‚‰ã®ãƒ‰ãƒ©ãƒƒã‚°ã¯æ‹’å¦
          if (e.target.closest('button, a, .icon-btn, .btn')) {
            logDragEvent('ã‚«ãƒ¼ãƒ‰ãƒ‰ãƒ©ãƒƒã‚°æ‹’å¦', {
              reason: 'ã‚¯ãƒªãƒƒã‚¯å¯èƒ½è¦ç´ ã‹ã‚‰ã®ãƒ‰ãƒ©ãƒƒã‚°',
              target: e.target.tagName,
              cardId: p.id
            });
            e.preventDefault();
            return;
          }

          logDragEvent('ã‚«ãƒ¼ãƒ‰ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹', { cardId: p.id, button: e.button });

          // é‡è¦ãªä¿®æ­£: ãƒ‡ãƒ¼ã‚¿ã‚’è¤‡æ•°ã®æ–¹æ³•ã§ä¿å­˜
          e.dataTransfer.clearData();

          // è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿å½¢å¼ã§ä¿å­˜ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§ã®ãŸã‚ï¼‰
          const dragData = JSON.stringify({ id: p.id, type: 'card', timestamp: Date.now() });
          e.dataTransfer.setData('text/plain', p.id);
          e.dataTransfer.setData('application/json', dragData);
          e.dataTransfer.effectAllowed = 'move';

          // ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãè¨­å®šã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
          logDragEvent('ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿è¨­å®šç¢ºèª', {
            cardId: p.id,
            plainText: e.dataTransfer.getData('text/plain'),
            jsonData: e.dataTransfer.getData('application/json'),
            types: Array.from(e.dataTransfer.types)
          });

          // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ã‚‚ä¿å­˜ï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰
          currentDragData = p.id;

          card.classList.add('dragging');
          card.dataset.dragging = 'card';

          // ã‚¤ãƒ™ãƒ³ãƒˆä¼æ’­ã‚’å®Œå…¨ã«åœæ­¢ï¼ˆdataTransferæ“ä½œå¾Œï¼‰
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();
        });

        // ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†æ™‚ã®å‡¦ç†ã‚’ç¢ºå®Ÿã«å®Ÿè¡Œ
        card.addEventListener('dragend', () => {
          card.classList.remove('dragging');
          delete card.dataset.dragging;
        });

        return card;
      }

      function openEditModal(p) {
        currentEdit = p;
        editTitle.value = p.title;
        editCategory.value = p.category || '';
        editTags.value = (p.tags || []).join(', ');
        editBody.value = p.body;
        editModal.showModal();
        editTitle.focus();
      }

      const ITEMS_PER_PAGE = 50;
      let currentPage = 0;
      let hasMoreItems = false;

      function render() {
        renderCategoryOptions();
        const items = filterAndSort(prompts);
        grid.innerHTML = '';
        currentPage = 0;

        if (!items.length) {
          const empty = document.createElement('div');
          empty.className = 'card';
          empty.innerHTML = '<div class="meta">çµæœãŒã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ•ã‚£ãƒ«ã‚¿ã‚’èª¿æ•´ã—ã¦ãã ã•ã„ã€‚</div>';
          grid.appendChild(empty);
          return;
        }

        const fragment = document.createDocumentFragment();
        const itemsToShow = items.slice(0, ITEMS_PER_PAGE);
        hasMoreItems = items.length > ITEMS_PER_PAGE;

        itemsToShow.forEach(p => fragment.appendChild(createCard(p)));

        // ã€Œã‚‚ã£ã¨è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã®è¿½åŠ 
        if (hasMoreItems) {
          const loadMoreBtn = document.createElement('button');
          loadMoreBtn.className = 'btn secondary';
          loadMoreBtn.textContent = `ã‚‚ã£ã¨è¡¨ç¤º (${items.length - ITEMS_PER_PAGE}ä»¶)`;
          loadMoreBtn.style.margin = '20px auto';
          loadMoreBtn.style.display = 'block';
          loadMoreBtn.addEventListener('click', () => loadMoreItems(items));
          fragment.appendChild(loadMoreBtn);
        }

        grid.appendChild(fragment);

        // ã‚°ãƒªãƒƒãƒ‰ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ‰ãƒ­ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’è¿½åŠ 
        setupGridDragAndDrop();

        // è¿½åŠ ã®ãƒ‡ãƒãƒƒã‚°ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.addEventListener('dragenter', (e) => {
          logDragEvent('ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆdragenter', {
            target: e.target.tagName,
            currentTarget: e.currentTarget.tagName,
            hasDataTransfer: !!e.dataTransfer,
            dataTypes: e.dataTransfer ? Array.from(e.dataTransfer.types) : [],
            dataContent: e.dataTransfer ? e.dataTransfer.getData('text/plain') : 'null'
          });
        });

        document.addEventListener('dragleave', (e) => {
          if (!document.contains(e.relatedTarget)) {
            logDragEvent('ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆdragleave', {
              target: e.target.tagName,
              relatedTarget: e.relatedTarget?.tagName || 'null',
              hasDataTransfer: !!e.dataTransfer,
              dataTypes: e.dataTransfer ? Array.from(e.dataTransfer.types) : [],
              dataContent: e.dataTransfer ? e.dataTransfer.getData('text/plain') : 'null'
            });
          }
        });

        // dataTransferã®å¤‰æ›´ã‚’ç›£è¦–ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.addEventListener('drag', (e) => {
          if (e.dataTransfer) {
            const plainData = e.dataTransfer.getData('text/plain');
            let jsonData = null;
            try {
              jsonData = e.dataTransfer.getData('application/json');
            } catch (error) {
              // JSONãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ç„¡è¦–
            }

            logDragEvent('ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆdrag', {
              target: e.target.tagName,
              plainData: plainData || 'empty',
              jsonData: jsonData ? 'present' : 'empty',
              dataTypes: Array.from(e.dataTransfer.types),
              effectAllowed: e.dataTransfer.effectAllowed,
              hasBackupData: !!currentDragData
            });

            // ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã«ãƒ‡ãƒ¼ã‚¿ãŒå¤±ã‚ã‚ŒãŸå ´åˆã®è­¦å‘Š
            if (!plainData && !jsonData && currentDragData) {
              logDragEvent('ãƒ‰ãƒ©ãƒƒã‚°ä¸­ãƒ‡ãƒ¼ã‚¿æå¤±æ¤œçŸ¥', {
                backupData: currentDragData,
                dataTypes: Array.from(e.dataTransfer.types)
              });
            }
          }
        });

        // ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹ã‹ã‚‰çµ‚äº†ã¾ã§ã®æ™‚é–“ã‚’ç›£è¦–
        let dragStartTime = null;
        document.addEventListener('dragstart', () => {
          dragStartTime = Date.now();
          logDragEvent('ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹æ™‚é–“è¨˜éŒ²', { startTime: dragStartTime });
        });

        document.addEventListener('dragend', () => {
          if (dragStartTime) {
            const dragDuration = Date.now() - dragStartTime;
            logDragEvent('ãƒ‰ãƒ©ãƒƒã‚°æŒç¶šæ™‚é–“', { duration: dragDuration });
            dragStartTime = null;
          }
        });
      }

      function setupGridDragAndDrop() {
        grid.addEventListener('dragover', (e) => {
          e.preventDefault();
          e.dataTransfer.dropEffect = 'move';

          // ãƒ‡ãƒãƒƒã‚°: ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªï¼ˆè¤‡æ•°ã®å½¢å¼ã‚’è©¦ã™ï¼‰
          let draggedId = e.dataTransfer.getData('text/plain');

          // text/plainãŒç©ºã®å ´åˆã¯application/jsonã‚’è©¦ã™
          if (!draggedId) {
            try {
              const jsonData = e.dataTransfer.getData('application/json');
              if (jsonData) {
                const parsed = JSON.parse(jsonData);
                draggedId = parsed.id;
                logDragEvent('ã‚°ãƒªãƒƒãƒ‰dragover JSONãƒ‡ãƒ¼ã‚¿ä½¿ç”¨', { parsedData: parsed, extractedId: draggedId });
              }
            } catch (error) {
              logDragEvent('ã‚°ãƒªãƒƒãƒ‰dragover JSONãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼', { error: error.message });
            }
          }

          // ãã‚Œã§ã‚‚ç©ºã®å ´åˆã¯ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½¿ç”¨
          if (!draggedId && currentDragData) {
            draggedId = currentDragData;
            logDragEvent('ã‚°ãƒªãƒƒãƒ‰dragover ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ä½¿ç”¨', { backupData: draggedId });
          }

          if (!draggedId) {
            logDragEvent('ã‚°ãƒªãƒƒãƒ‰dragoverå¤±æ•—', {
              reason: 'ãƒ‰ãƒ©ãƒƒã‚°ãƒ‡ãƒ¼ã‚¿ãŒç©º',
              dataTypes: Array.from(e.dataTransfer.types),
              hasBackupData: !!currentDragData
            });
            return;
          }

          logDragEvent('ã‚°ãƒªãƒƒãƒ‰dragover', {
            draggedId,
            mouseY: e.clientY,
            target: e.target.tagName
          });

          // ãƒ‰ãƒ­ãƒƒãƒ—ä½ç½®ã®è¦–è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
          document.querySelectorAll('.card.drag-over').forEach(card => {
            card.classList.remove('drag-over');
          });

          const afterElement = getDragAfterElement(grid, e.clientY);
          if (afterElement) {
            afterElement.classList.add('drag-over');
            logDragEvent('ãƒ‰ãƒ­ãƒƒãƒ—ä½ç½®ãƒã‚¤ãƒ©ã‚¤ãƒˆ', {
              afterElementId: afterElement.dataset.id
            });
          }
        });

        grid.addEventListener('drop', (e) => {
          e.preventDefault();

          logDragEvent('ã‚°ãƒªãƒƒãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—é–‹å§‹', {
            hasDataTransfer: !!e.dataTransfer,
            dataTypes: e.dataTransfer ? Array.from(e.dataTransfer.types) : [],
            mouseY: e.clientY
          });

          if (!e.dataTransfer) {
            logDragEvent('ãƒ‰ãƒ­ãƒƒãƒ—å¤±æ•—', { reason: 'dataTransferãŒå­˜åœ¨ã—ã¾ã›ã‚“' });
            cleanupDragState();
            return;
          }

          let draggedId = e.dataTransfer.getData('text/plain');

          // text/plainãŒç©ºã®å ´åˆã¯application/jsonã‚’è©¦ã™
          if (!draggedId) {
            try {
              const jsonData = e.dataTransfer.getData('application/json');
              if (jsonData) {
                const parsed = JSON.parse(jsonData);
                draggedId = parsed.id;
                logDragEvent('JSONãƒ‡ãƒ¼ã‚¿ä½¿ç”¨', { parsedData: parsed, extractedId: draggedId });
              }
            } catch (error) {
              logDragEvent('JSONãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼', { error: error.message });
            }
          }

          // dataTransferã®ãƒ‡ãƒ¼ã‚¿ãŒç©ºã®å ´åˆã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‹ã‚‰å–å¾—
          if (!draggedId && currentDragData) {
            logDragEvent('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ä½¿ç”¨', { backupData: currentDragData });
            draggedId = currentDragData;
          }

          if (!draggedId) {
            logDragEvent('ãƒ‰ãƒ­ãƒƒãƒ—å¤±æ•—', {
              reason: 'ãƒ‰ãƒ©ãƒƒã‚°ãƒ‡ãƒ¼ã‚¿ãŒç©º',
              dataTypes: Array.from(e.dataTransfer.types),
              hasBackupData: !!currentDragData
            });
            cleanupDragState();
            return;
          }

          const draggingCard = document.querySelector(`[data-id="${draggedId}"]`);
          if (!draggingCard) {
            logDragEvent('ãƒ‰ãƒ­ãƒƒãƒ—å¤±æ•—', { draggedId, reason: 'ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®ã‚«ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“' });
            cleanupDragState();
            return;
          }

          // ãƒ‰ãƒ­ãƒƒãƒ—ä½ç½®ã‚’å–å¾—
          const afterElement = getDragAfterElement(grid, e.clientY);

          // ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®ã‚«ãƒ¼ãƒ‰ã‚’é©åˆ‡ãªä½ç½®ã«ç§»å‹•
          try {
            if (afterElement && afterElement !== draggingCard) {
              grid.insertBefore(draggingCard, afterElement);
            } else if (!afterElement) {
              grid.appendChild(draggingCard);
            }

            // é †åºã‚’æ›´æ–°
            updatePromptOrder();
            showToast('é †åºã‚’ä¿å­˜ã—ã¾ã—ãŸ');
            logDragEvent('ãƒ‰ãƒ­ãƒƒãƒ—æˆåŠŸ', { draggedId, afterElementId: afterElement?.dataset.id || 'end' });
          } catch (error) {
            logDragEvent('ãƒ‰ãƒ­ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼', { draggedId, error: error.message });
            showToast('é †åºã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
          } finally {
            // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’ã‚¯ãƒªã‚¢
            currentDragData = null;
            // è¦–è¦šåŠ¹æœã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆç¢ºå®Ÿã«å®Ÿè¡Œï¼‰
            cleanupDragState();
          }
        });

        // ãƒ‰ãƒ©ãƒƒã‚°ãŒã‚°ãƒªãƒƒãƒ‰å¤–ã«å‡ºãŸå ´åˆã®å‡¦ç†
        grid.addEventListener('dragleave', (e) => {
          if (!grid.contains(e.relatedTarget)) {
            logDragEvent('ã‚°ãƒªãƒƒãƒ‰dragleave', {
              reason: 'ã‚°ãƒªãƒƒãƒ‰å¤–ã«å‡ºãŸ',
              target: e.target.tagName,
              relatedTarget: e.relatedTarget?.tagName || 'null'
            });
            document.querySelectorAll('.card.drag-over').forEach(card => {
              card.classList.remove('drag-over');
            });
          }
        });

        // å®‰å…¨ç­–ï¼šãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå…¨ä½“ã§ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†ã‚’ç›£è¦–
        document.addEventListener('dragend', (e) => {
          logDragEvent('ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆdragend', {
            hasDataTransfer: !!e.dataTransfer,
            dataTypes: e.dataTransfer ? Array.from(e.dataTransfer.types) : [],
            dataContent: e.dataTransfer ? e.dataTransfer.getData('text/plain') : 'null',
            target: e.target.tagName,
            type: e.type
          });

          // ãƒ‰ãƒ©ãƒƒã‚°ãŒå®Œäº†ã¾ãŸã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸå ´åˆã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
          cleanupDragState();

          // ãƒ‰ãƒ©ãƒƒã‚°ãƒ‡ãƒ¼ã‚¿ãŒç©ºã®å ´åˆï¼ˆã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸå ´åˆï¼‰ã¯é †åºã‚’ä¿å­˜ã—ãªã„
          let draggedId = e.dataTransfer ? e.dataTransfer.getData('text/plain') : null;

          // text/plainãŒç©ºã®å ´åˆã¯application/jsonã‚’è©¦ã™
          if (!draggedId && e.dataTransfer) {
            try {
              const jsonData = e.dataTransfer.getData('application/json');
              if (jsonData) {
                const parsed = JSON.parse(jsonData);
                draggedId = parsed.id;
                logDragEvent('dragend JSONãƒ‡ãƒ¼ã‚¿ä½¿ç”¨', { parsedData: parsed, extractedId: draggedId });
              }
            } catch (error) {
              logDragEvent('dragend JSONãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼', { error: error.message });
            }
          }

          // dataTransferã®ãƒ‡ãƒ¼ã‚¿ãŒç©ºã®å ´åˆã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‹ã‚‰å–å¾—
          if (!draggedId && currentDragData) {
            logDragEvent('dragendãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ä½¿ç”¨', { backupData: currentDragData });
            draggedId = currentDragData;
          }

          if (!draggedId) {
            logDragEvent('ãƒ‰ãƒ©ãƒƒã‚°ã‚­ãƒ£ãƒ³ã‚»ãƒ«', {
              reason: 'ãƒ‰ãƒ©ãƒƒã‚°ãƒ‡ãƒ¼ã‚¿ãŒç©º',
              hasDataTransfer: !!e.dataTransfer,
              dataTypes: e.dataTransfer ? Array.from(e.dataTransfer.types) : [],
              hasBackupData: !!currentDragData
            });
            currentDragData = null; // ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã‚‚ã‚¯ãƒªã‚¢
            return;
          }

          logDragEvent('ãƒ‰ãƒ©ãƒƒã‚°å®Œäº†', { draggedId });
          currentDragData = null; // å®Œäº†å¾Œã¯ã‚¯ãƒªã‚¢
        });
      }

      // ãƒ‰ãƒ©ãƒƒã‚°çŠ¶æ…‹ã®ä¸€å…ƒåŒ–ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°
      function cleanupDragState() {
        // ã™ã¹ã¦ã®draggingã‚¯ãƒ©ã‚¹ã€drag-overã‚¯ãƒ©ã‚¹ã€draggingå±æ€§ã‚’å‰Šé™¤
        document.querySelectorAll('.card.dragging, .card.drag-over').forEach(card => {
          card.classList.remove('dragging', 'drag-over');
          delete card.dataset.dragging;
        });
      }

      function getDragAfterElement(container, y) {
        const draggableElements = [...container.querySelectorAll('.card:not(.dragging)')];

        return draggableElements.reduce((closest, child) => {
          const box = child.getBoundingClientRect();
          const offset = y - box.top - box.height / 2;

          // ãƒã‚¦ã‚¹ãŒè¦ç´ ã®ä¸ŠåŠåˆ†ã«ã‚ã‚‹å ´åˆã®ã¿è€ƒæ…®
          if (offset < 0 && offset > closest.offset) {
            return { offset: offset, element: child };
          } else {
            return closest;
          }
        }, { offset: Number.NEGATIVE_INFINITY }).element;
      }



      function updatePromptOrder() {
        const cards = [...grid.querySelectorAll('.card')];
        const newOrder = cards.map(card => card.dataset.id);
        const orderedPrompts = newOrder.map(id => prompts.find(p => p.id === id)).filter(Boolean);

        prompts = orderedPrompts;
        saveToStorage(prompts);
      }

      function loadMoreItems(allItems) {
        currentPage++;
        const start = currentPage * ITEMS_PER_PAGE;
        const end = start + ITEMS_PER_PAGE;
        const itemsToAdd = allItems.slice(start, end);
        hasMoreItems = allItems.length > end;

        const fragment = document.createDocumentFragment();
        itemsToAdd.forEach(p => fragment.appendChild(createCard(p)));

        // ã€Œã‚‚ã£ã¨è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã‚’æ›´æ–°ã¾ãŸã¯å‰Šé™¤
        const loadMoreBtn = grid.querySelector('.btn.secondary');
        if (loadMoreBtn) {
          if (hasMoreItems) {
            loadMoreBtn.textContent = `ã‚‚ã£ã¨è¡¨ç¤º (${allItems.length - end}ä»¶)`;
          } else {
            loadMoreBtn.remove();
          }
        }

        grid.appendChild(fragment);

        // æ–°ã—ã„ã‚«ãƒ¼ãƒ‰ã«ã‚‚ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã‚’é©ç”¨
        setupGridDragAndDrop();
      }

      // ------------------------------
      // ã‚¤ãƒ™ãƒ³ãƒˆ
      // ------------------------------
      const debouncedSearch = debounce(() => {
        state.query = qInput.value;
        render();
      }, 300);

      qInput.addEventListener('input', debouncedSearch);
      categorySelect.addEventListener('change', (e) => { state.category = e.target.value; render(); });
      onlyFavInput.addEventListener('change', (e) => { state.onlyFavorite = e.target.checked; render(); });
      sortSelect.addEventListener('change', (e) => { state.sort = e.target.value; render(); });

      document.getElementById('exportBtn').addEventListener('click', () => {
        const data = JSON.stringify(prompts, null, 2);
        const blob = new Blob([data], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'promptbox-export.json'; a.click();
        URL.revokeObjectURL(url);
        showToast('JSONã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
      });

      document.getElementById('importBtn').addEventListener('click', () => {
        document.getElementById('importFile').click();
      });

      document.getElementById('importFile').addEventListener('change', async (e) => {
        const file = e.target.files?.[0];
        if (!file) return;
        try {
          const text = await file.text();
          const json = JSON.parse(text);
          if (!Array.isArray(json)) throw new Error('invalid');
          // æœ€ä½é™ã®æ­£è¦åŒ–
          prompts = json.map(p => ({
            id: p.id || cryptoRandomId(),
            title: String(p.title || 'ç„¡é¡Œ'),
            category: String(p.category || 'æœªåˆ†é¡'),
            tags: Array.isArray(p.tags) ? p.tags.map(String) : [],
            body: String(p.body || ''),
            favorite: Boolean(p.favorite),
            createdAt: Number(p.createdAt || Date.now()),
          }));
          saveToStorage(prompts);
          render();
          showToast('JSONã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
        } catch (err) {
          console.error(err);
          showToast('ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ');
        } finally {
          e.target.value = '';
        }
      });

      // è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ«
      const addModal = document.getElementById('addModal');
      const openAdd = document.getElementById('openAdd');
      const closeAdd = document.getElementById('closeAdd');
      const resetAdd = document.getElementById('resetAdd');
      const addTitle = document.getElementById('addTitle');
      const addCategory = document.getElementById('addCategory');
      const addTags = document.getElementById('addTags');
      const addBody = document.getElementById('addBody');

      openAdd.addEventListener('click', () => { addModal.showModal(); addTitle.focus(); });
      closeAdd.addEventListener('click', () => addModal.close());
      resetAdd.addEventListener('click', () => { addTitle.value = ''; addCategory.value = ''; addTags.value = ''; addBody.value = ''; addTitle.focus(); });

      addModal.addEventListener('close', () => {
        // ãƒ•ã‚©ãƒ¼ãƒ ã®æ—¢å®šå‹•ä½œã«ã‚ˆã‚‹closeæ™‚ã¯ä½•ã‚‚ã—ãªã„
      });

      addModal.querySelector('form').addEventListener('submit', (e) => {
        e.preventDefault();
        const title = addTitle.value.trim();
        const category = addCategory.value.trim() || 'æœªåˆ†é¡';
        const tags = addTags.value.split(',').map(s => s.trim()).filter(Boolean);
        const body = addBody.value.trim();
        if (!title || !body) { showToast('ã‚¿ã‚¤ãƒˆãƒ«ã¨æœ¬æ–‡ã¯å¿…é ˆã§ã™'); return; }
        const item = { id: cryptoRandomId(), title, category, tags, body, favorite: false, createdAt: Date.now() };
        prompts.unshift(item);
        saveToStorage(prompts);
        addModal.close();
        render();
        addTitle.value = ''; addCategory.value = ''; addTags.value = ''; addBody.value = '';
        showToast('è¿½åŠ ã—ã¾ã—ãŸ');
      });

      // åˆæœŸæç”»
      render();

      // ä¸è¦ã«ãªã£ãŸãƒ¢ãƒ¼ãƒ€ãƒ«é–¢é€£ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ’¤å»
      // ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«é–¢é€£
      const editModal = document.getElementById('editModal');
      const closeEdit = document.getElementById('closeEdit');
      const cancelEdit = document.getElementById('cancelEdit');
      const saveEdit = document.getElementById('saveEdit');
      const editTitle = document.getElementById('editTitle');
      const editCategory = document.getElementById('editCategory');
      const editTags = document.getElementById('editTags');
      const editBody = document.getElementById('editBody');
      let currentEdit = null;

      closeEdit.addEventListener('click', () => editModal.close());
      cancelEdit.addEventListener('click', () => editModal.close());
      editModal.querySelector('form').addEventListener('submit', (e) => {
        e.preventDefault();
        if (!currentEdit) return editModal.close();
        const title = editTitle.value.trim();
        const category = editCategory.value.trim() || 'æœªåˆ†é¡';
        const tags = editTags.value.split(',').map(s => s.trim()).filter(Boolean);
        const body = editBody.value.trim();
        if (!title || !body) { showToast('ã‚¿ã‚¤ãƒˆãƒ«ã¨æœ¬æ–‡ã¯å¿…é ˆã§ã™'); return; }
        currentEdit.title = title;
        currentEdit.category = category;
        currentEdit.tags = tags;
        currentEdit.body = body;
        saveToStorage(prompts);
        editModal.close();
        render();
        showToast('æ›´æ–°ã—ã¾ã—ãŸ');
      });
    </script>
  </body>
</html>


